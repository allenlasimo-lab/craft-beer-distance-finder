<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Craft Beer Distance Finder (No-React)</title>
<style>
  :root{--bg:#f5f5f5;--txt:#111;--muted:#666;--card:#fff;--border:#e5e5e5}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  .row{display:grid;grid-template-columns:1fr;gap:16px}
  @media (min-width:900px){.row{grid-template-columns:7fr 5fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  h1{margin:0 0 6px;font-size:28px} h2{margin:0 0 12px;font-size:18px}
  .muted{color:var(--muted)} .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{border:1px solid var(--border);background:#fff;padding:10px 12px;border-radius:12px;cursor:pointer}
  .btn.primary{background:#111;color:#fff;border-color:#111}
  .input, select, textarea{border:1px solid var(--border);border-radius:12px;padding:10px 12px}
  .input{width:150px} .grow{flex:1}
  .shop{display:flex;gap:12px;justify-content:space-between;align-items:flex-start}
  .shop h3{margin:0 0 4px;font-size:18px}
  .list{display:flex;flex-direction:column;gap:12px}
  .footer{margin-top:28px;font-size:12px;color:var(--muted)}
  .right{display:flex;gap:8px}
  .bad{background:#fff3f3;border-color:#ffd6d6}
</style>
</head>
<body>
  <div class="container">
    <header class="card">
      <div style="display:flex;gap:12px;justify-content:space-between;align-items:flex-end;flex-wrap:wrap">
        <div>
          <h1>üç∫ Craft Beer Distance Finder (TH)</h1>
          <div class="muted">‡∏´‡∏≤/‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ï‡πå‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‚Äì ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏∞‡πÑ‡∏£</div>
        </div>
        <div class="right">
          <button id="exportBtn" class="btn">Export JSON</button>
          <button id="toggleImport" class="btn">Import JSON</button>
        </div>
      </div>
    </header>

    <section id="importBox" class="card bad" style="display:none">
      <h2>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô (JSON)</h2>
      <div class="muted" style="margin-bottom:8px">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: <span class="mono">[{name, city, lat, lng, address, url}, ...]</span></div>
      <textarea id="importText" rows="7" style="width:100%" placeholder='[
  {"name":"Your Taproom","city":"Bangkok","lat":13.75,"lng":100.50,"address":"...","url":"https://..."}
]'></textarea>
      <div class="controls" style="margin-top:8px">
        <button id="doImport" class="btn primary">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</button>
        <button id="cancelImport" class="btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </section>

    <div class="row">
      <section class="card">
        <h2>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
        <div class="controls">
          <button id="useLoc" class="btn primary">‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
          <button id="clearLoc" class="btn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</button>
          <input id="lat" class="input" placeholder="‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (13.75)" />
          <input id="lng" class="input" placeholder="‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (100.50)" />
          <button id="setManual" class="btn">‡∏ï‡∏±‡πâ‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏≠‡∏á</button>
          <span class="muted" style="margin-left:auto">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
          <select id="unit">
            <option value="km" selected>‡∏Å‡∏°.</option>
            <option value="mi">‡πÑ‡∏°‡∏•‡πå</option>
          </select>
        </div>
        <div id="locInfo" class="muted" style="margin-top:6px"></div>
      </section>

      <section class="card">
        <h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏Å‡∏£‡∏≠‡∏á/‡πÄ‡∏£‡∏µ‡∏¢‡∏á</h2>
        <div class="controls">
          <input id="query" class="input grow" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / ‡πÄ‡∏°‡∏∑‡∏≠‡∏á / ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà" />
          <select id="city"></select>
          <select id="sort">
            <option value="distance" selected>‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</option>
            <option value="name">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠</option>
          </select>
        </div>
        <div class="muted" style="margin-top:6px">* ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</div>
      </section>
    </div>

    <section style="margin-top:16px">
      <div class="card" style="display:flex;justify-content:space-between;align-items:center">
        <h2 id="resultTitle">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
        <div class="muted">‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Google Maps</div>
      </div>
      <div id="list" class="list" style="margin-top:12px"></div>
    </section>

    <div class="footer">
      ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏¥‡∏ï ‚óè ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Import JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </div>
  </div>

<script>
  // --------- Data & Utils ---------
  const DEFAULT_SHOPS = [
    { id: 1, name: "Hair of the Dog (Phloen Chit)", city: "Bangkok", lat: 13.743, lng: 100.549, address: "Ploenchit Center", url: "https://maps.google.com/?q=Hair+of+the+Dog+Bangkok" },
    { id: 2, name: "Mikkeller Bangkok", city: "Bangkok", lat: 13.7276, lng: 100.5848, address: "Ekkamai Soi 10", url: "https://maps.google.com/?q=Mikkeller+Bangkok" },
    { id: 3, name: "CRAFT Sukhumvit 23", city: "Bangkok", lat: 13.739, lng: 100.562, address: "Sukhumvit 23", url: "https://maps.google.com/?q=CRAFT+Sukhumvit+23" },
    { id: 4, name: "Brewski (Radisson Blu)", city: "Bangkok", lat: 13.7367, lng: 100.5606, address: "Sukhumvit 27", url: "https://maps.google.com/?q=Brewski+Bangkok" },
    { id: 5, name: "Beer Belly (Thonglor)", city: "Bangkok", lat: 13.734, lng: 100.581, address: "Thonglor", url: "https://maps.google.com/?q=Beer+Belly+Thonglor" },
    { id: 6, name: "Pijiu Bar (Chinatown)", city: "Bangkok", lat: 13.7399, lng: 100.509, address: "Yaowarat", url: "https://maps.google.com/?q=Pijiu+Bar+Bangkok" },
    { id: 7, name: "The Beer Cap (The Commons)", city: "Bangkok", lat: 13.7339, lng: 100.5799, address: "Thonglor", url: "https://maps.google.com/?q=The+Beer+Cap+Bangkok" },
    { id: 8, name: "Taproom Sala Daeng", city: "Bangkok", lat: 13.728, lng: 100.534, address: "Sala Daeng", url: "https://maps.google.com/?q=Taproom+Sala+Daeng" },
    { id: 9, name: "Londoner Brew Pub", city: "Bangkok", lat: 13.7262, lng: 100.6478, address: "Pattanakarn", url: "https://maps.google.com/?q=The+Londoner+Brew+Pub" },
    { id:10, name: "Chitbeer (Ko Kret)", city: "Nonthaburi", lat:13.93, lng:100.491, address: "Ko Kret", url: "https://maps.google.com/?q=Chitbeer" },
    { id:11, name: "Beer Lab Nimman", city: "Chiang Mai", lat:18.796, lng:98.9696, address: "Nimman", url: "https://maps.google.com/?q=Beer+Lab+Nimman" },
    { id:12, name: "My Beer Friend (Taproom)", city: "Chiang Mai", lat:18.795, lng:98.966, address: "Nimman/Old City", url: "https://maps.google.com/?q=My+Beer+Friend+Chiang+Mai" },
    { id:13, name: "Chit Hole CNX", city: "Chiang Mai", lat:18.7908, lng:98.9986, address: "Old City", url: "https://maps.google.com/?q=Chit+Hole+Chiang+Mai" },
    { id:14, name: "Full Moon Brewworks (Taproom)", city: "Phuket", lat:7.884, lng:98.39, address: "Old Town", url: "https://maps.google.com/?q=Full+Moon+Brewworks+Phuket" },
    { id:15, name: "BrewBridge Craft Beer Bar", city: "Phuket", lat:8.005, lng:98.305, address: "Choeng Thale", url: "https://maps.google.com/?q=BrewBridge+Phuket" },
    { id:16, name: "Hops Brewhouse (Pattaya)", city: "Pattaya", lat:12.929, lng:100.883, address: "Beach Rd.", url: "https://maps.google.com/?q=Hops+Brewhouse+Pattaya" },
    { id:17, name: "Wizard Brewery (Pattaya)", city: "Pattaya", lat:12.9303, lng:100.8836, address: "Central", url: "https://maps.google.com/?q=Wizard+Brewery+Pattaya" },
    { id:18, name: "24 Taps (Khon Kaen)", city: "Khon Kaen", lat:16.4419, lng:102.835, address: "City", url: "https://maps.google.com/?q=24+Taps+Khon+Kaen" },
    { id:19, name: "Hop Beer House Korat", city: "Nakhon Ratchasima", lat:14.973, lng:102.083, address: "Korat", url: "https://maps.google.com/?q=Hop+Beer+House+Korat" },
    { id:20, name: "Rimzra Brewhouse (Samui)", city: "Koh Samui", lat:9.534, lng:100.055, address: "Samui", url: "https://maps.google.com/?q=Rimzra+Brewhouse+Samui" },
    { id:21, name: "Outlaw Brewing (Loei)", city: "Loei", lat:17.488, lng:101.736, address: "Phu Ruea", url: "https://maps.google.com/?q=Outlaw+Brewing+Loei" },
    { id:22, name: "Beer Hubb (Pattaya)", city: "Pattaya", lat:12.935, lng:100.889, address: "Beach Rd.", url: "https://maps.google.com/?q=Beer+Hubb+Pattaya" },
    { id:23, name: "The Beer Cap (Saladaeng)", city: "Bangkok", lat:13.7249, lng:100.5396, address: "Saladaeng", url: "https://maps.google.com/?q=The+Beer+Cap+Saladaeng" },
    { id:24, name: "Taproom Ari (Dok Kaew)", city: "Bangkok", lat:13.7792, lng:100.543, address: "Ari", url: "https://maps.google.com/?q=Dok+Kaew+House+Bar" },
    { id:25, name: "Pijiu Bar (Old Town)", city: "Bangkok", lat:13.7439, lng:100.496, address: "Old Town", url: "https://maps.google.com/?q=Pijiu+Bar+Old+Town" }
  ];

  function toRad(d){return d*Math.PI/180}
  function haversine(lat1,lon1,lat2,lon2,unit="km"){
    const R = unit==="km"?6371:3958.8;
    const dLat = toRad(lat2-lat1), dLon = toRad(lon2-lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    const c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    return R*c;
  }

  // --------- State ---------
  let unit = "km";
  let shops = [...DEFAULT_SHOPS];
  let myLoc = null;
  let query = "";
  let cityFilter = "all";
  let sortKey = "distance";

  // --------- DOM refs ---------
  const $resultTitle = document.getElementById("resultTitle");
  const $list = document.getElementById("list");
  const $unit = document.getElementById("unit");
  const $useLoc = document.getElementById("useLoc");
  const $clearLoc = document.getElementById("clearLoc");
  const $lat = document.getElementById("lat");
  const $lng = document.getElementById("lng");
  const $setManual = document.getElementById("setManual");
  const $locInfo = document.getElementById("locInfo");
  const $query = document.getElementById("query");
  const $city = document.getElementById("city");
  const $sort = document.getElementById("sort");
  const $exportBtn = document.getElementById("exportBtn");
  const $toggleImport = document.getElementById("toggleImport");
  const $importBox = document.getElementById("importBox");
  const $importText = document.getElementById("importText");
  const $doImport = document.getElementById("doImport");
  const $cancelImport = document.getElementById("cancelImport");

  // --------- Init ---------
  function refreshCityOptions(){
    const cities = Array.from(new Set(shops.map(s=>s.city).filter(Boolean))).sort();
    $city.innerHTML = `<option value="all">‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡∏≠‡∏á</option>` + cities.map(c=>`<option value="${c}">${c}</option>`).join("");
    $city.value = cityFilter;
  }

  function computeList(){
    let rows = shops.map(s=>{
      let distance = null;
      if(myLoc) distance = haversine(myLoc.lat,myLoc.lng,s.lat,s.lng,unit);
      return { ...s, distance };
    }).filter(s=>{
      const qok = !query || (s.name+" "+s.city+" "+(s.address||"")).toLowerCase().includes(query.toLowerCase());
      const cok = (cityFilter==="all") || s.city===cityFilter;
      return qok && cok;
    }).sort((a,b)=>{
      if(sortKey==="name") return a.name.localeCompare(b.name);
      if(a.distance==null && b.distance==null) return a.name.localeCompare(b.name);
      if(a.distance==null) return 1;
      if(b.distance==null) return -1;
      return a.distance - b.distance;
    });

    $resultTitle.textContent = `‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (${rows.length} ‡∏£‡πâ‡∏≤‡∏ô)`;
    $list.innerHTML = rows.map(s=>`
      <div class="card">
        <div class="shop">
          <div>
            <h3>${s.name}</h3>
            <div class="muted">${s.city}${s.address?` ‚Ä¢ ${s.address}`:""}</div>
            ${s.distance!=null
              ? `<div><b>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:</b> ${s.distance.toFixed(2)} ${unit}</div>`
              : `<div class="muted">(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‚Äî ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</div>`
            }
          </div>
          <div class="right">
            <button class="btn primary" onclick="openDirections(${s.lat},${s.lng},'${encodeURIComponent(s.name)}')">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</button>
            <a class="btn" href="${s.url || `https://www.google.com/maps?q=${encodeURIComponent(s.name)}`}" target="_blank" rel="noreferrer">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>
          </div>
        </div>
      </div>
    `).join("");

    window.openDirections = (lat,lng,name)=>{
      if(myLoc){
        const url = `https://www.google.com/maps/dir/?api=1&origin=${myLoc.lat},${myLoc.lng}&destination=${lat},${lng}`;
        window.open(url,"_blank");
      }else{
        window.open(`https://www.google.com/maps?q=${name}`,"_blank");
      }
    }
  }

  function setLocInfo(){
    if(myLoc) $locInfo.innerHTML = `‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span class="mono">${myLoc.lat.toFixed(5)}, ${myLoc.lng.toFixed(5)}</span>`;
    else $locInfo.textContent = "";
  }

  // Fill UI
  refreshCityOptions();
  computeList();

  // --------- Events ---------
  $unit.onchange = ()=>{ unit = $unit.value; computeList(); }
  $useLoc.onclick = ()=>{
    if(!("geolocation" in navigator)) return alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á");
    navigator.geolocation.getCurrentPosition(
      pos=>{ myLoc = {lat:pos.coords.latitude, lng:pos.coords.longitude}; setLocInfo(); computeList(); },
      err=>alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: "+err.message),
      {enableHighAccuracy:true,timeout:10000}
    );
  }
  $clearLoc.onclick = ()=>{ myLoc = null; setLocInfo(); computeList(); }
  $setManual.onclick = ()=>{
    const lat = parseFloat($lat.value), lng = parseFloat($lng.value);
    if(Number.isFinite(lat) && Number.isFinite(lng)){ myLoc = {lat,lng}; setLocInfo(); computeList(); }
    else alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î/‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  }
  $query.oninput = ()=>{ query = $query.value.trim(); computeList(); }
  $city.onchange = ()=>{ cityFilter = $city.value; computeList(); }
  $sort.onchange = ()=>{ sortKey = $sort.value; computeList(); }

  $exportBtn.onclick = async ()=>{
    const payload = shops.map(({id, ...rest})=>rest);
    const text = JSON.stringify(payload,null,2);
    try{ await navigator.clipboard.writeText(text); alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß"); }
    catch{ alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏ã‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ"); console.log(text); }
  }

  $toggleImport.onclick = ()=>{ $importBox.style.display = $importBox.style.display==="none"?"block":"none"; }
  $cancelImport.onclick = ()=>{ $importText.value=""; $importBox.style.display="none"; }
  $doImport.onclick = ()=>{
    try{
      const parsed = JSON.parse($importText.value);
      if(!Array.isArray(parsed)) throw new Error("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Array");
      const normalized = parsed.map((s,idx)=>({
        id: Date.now()+idx,
        name: s.name ?? "Unnamed",
        city: s.city ?? "",
        lat: Number(s.lat),
        lng: Number(s.lng),
        address: s.address ?? "",
        url: s.url ?? ""
      })).filter(s=>Number.isFinite(s.lat)&&Number.isFinite(s.lng));
      if(!normalized.length) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      shops = normalized;
      refreshCityOptions(); computeList();
      $importText.value=""; $importBox.style.display="none";
    }catch(e){ alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: "+e.message); }
  }
</script>
</body>
</html>
